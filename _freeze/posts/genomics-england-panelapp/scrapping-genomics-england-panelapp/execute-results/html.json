{
  "hash": "a1a0b46ce61bb0bb566ec94bf41acd30",
  "result": {
    "markdown": "---\ntitle: \"Extracting gene panels from the Genomics England Panelapp\"\nformat: html\neditor: visual \ntoc: false\nauthor: Francisco Requena\ndate: 3/20/2021 \nsidebar: true\nimage: images/image.png\ncategories:\n  - web-scrapping\n  - R\n  - genetics\n---\n\n\n\n\n\n\nThe [Genomics England PanelApp](https://panelapp.genomicsengland.co.uk/) provides panels of genes related to human disorders manually curated by healthcare experts. From a clinical and research perspective, this is a remarkable resource. At the time of writing this post, over 320 panels have been published.\n\nUnfortunately, you can only download the panels manually one at a time or through an API that retrieves the information as a JSON file.\n\nAlternatively, below you can find a script in R to extract all the panels from the website and merge them into a single dataset. Please note the following points before using the script:\n\n* I only consider genes labeled as \"Expert Review Green\" defined as \"gene-disease association with a high level of evidence\" and exclude STRs and CNVs entities. More information on the criteria used can be found on the main page (heading: Understanding gene classifications in a version 1+ gene panel.\n* The script selects only a subset of columns from the total available. \nBe careful, the script will download more than 320 files automatically (on my laptop, the execution process is ~7 min).\n* The script is ready to run on the Linux system.\n\nAs the script is based on the current website structure, any changes could break the code. Please let me know if this happens. I will try to code an updated version of the code.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(rvest)\nlibrary(purrr)\nlibrary(tidyverse)\nwebsite <- \"https://panelapp.genomicsengland.co.uk/panels/\"\npage <- read_html(website)\nc_ref <- page %>%\n  html_nodes(\"a\") %>% # find all links\n  html_attr(\"href\")\ndf_ref <- tibble(ref = c_ref, id = NA) %>%\n  filter(str_detect(ref, 'download')) %>%\n  mutate(ref = str_remove(ref, '/panels/')) %>%\n  mutate(id = ref) %>%\n  mutate(id = str_remove(id, '/download/01234/'))\n# Linux command - if you are using Windows, please make sure that you create a new folder with the name 'gene_panel'\n# and remove the \"system('mkdir gene_panel')\" line\nsystem('mkdir gene_panel')\nsetwd('gene_panel')\nwalk2(df_ref$ref, df_ref$id, function(a, b)\n  download.file(url = paste0(website, a), destfile = paste0('gene_panel_', b))\n)\nfiles_panel <- list.files()\npanel_total <- files_panel %>% map_dfr(~ read_tsv(.x) %>% \n                                         select(`Entity Name`, `Entity type`, `Gene Symbol`, `Sources(; separated)`, \n                                                Level4, Phenotypes) %>% \n                                         mutate(source = .x) )\n# Filtering out genes with a evidence level (red - amber)\npanel_total <- panel_total %>%\n  rename(entity_name = `Entity Name`,\n         entity_type = `Entity type`,\n         gene = `Gene Symbol`,\n         sources = `Sources(; separated)`) %>%\n  filter(entity_type == 'gene') %>%  # optional - we can include regions in our analysis\n  filter(str_detect(sources, 'Expert Review Green')) %>%\n  select(gene, Level4, -sources, source, Phenotypes)\nsetwd('..')\nwrite_tsv(panel_total, 'panel_genes.tsv')\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}